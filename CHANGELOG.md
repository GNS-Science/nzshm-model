# Changelog

## [0.13.7] 2050-08-TBC
## Changed
 - add support for python 312 and 313
 - upgrade lxml lib (for python 3.13 support)

## [0.13.6] 2025-04-01
 - get_by_extra method on BranchRegistry to cope with errant hazard jobs (ref T3BlbnF1YWtlSGF6YXJkVGFzazo2OTMxODkz)

## [0.13.5] 2025-02-28

### Added 
- str representation of HazardConfig objects

### Changed
- OpenquakeConfig.is_complete() works for disaggregation configurations
- OpenquakeConfig.set_parameter() coerces value to str
- moved scripts and resources packages to be under nzshm_model package

## [0.13.4] 2024-12-12

### Added
- from_dict method to HazardConfig and OpenquakeConfig classes
- factory method for obtaining HazardConfig type
- z1.0 and z2.5 calculation function ported from openquake

### Changed
- hazard config for model versions stored as file

### Removed
 - OpenQuake dependency

## [0.13.3] 2024-09-26

### Added
 - read and write OpenquakeConfig objects as JSON files

## [0.13.2] 2024-09-22

### Changed
 - improved type hints

### Changed
 - moved version 1 source logic tree definitions out of package directory and into resources

## [0.13.1] 2024-09-09

### Added
 - cli command to convert SourceLogicTree v1 module files to v2 json files

### Changed
 - add branch_id when converting from SourceLogicTree v1 to v2

## [0.13.0] 2024-08-21

### Changed
 - `NhsmModel` initialized with component objects (i.e. LogicTree objects) rather than files
 - Creating `NshmModel` object from files handled by classmethod `from_files`

### Removed
 - `NshmModel.gmm_logic_tree_from_xml` method. Use `OpenquakeGMCMPshaAdapter.gmcm_logic_tree_from_xml` instead

## [0.12.1] 2024-08-20

### Added 
 - support for sites in `OpenquakeConfig` and `OpenquakeConfigPshaAdapter`
 - usage documentation for `OpenquakeConfig` and adapter classes

### Changed
 - flexibility in defining uniform site parameters

## [0.12.0] 2024-08-14

### Added
 - OpenQuake adapter classes for source logic tree, gmcm logic tree, and hazard configuration
 - `OpenquakeSimplePshaAdapter` writes entire set of OpenQuake input files
 - hazard_config attribute of `NshmModel` class
 - OpenQuake configuration of hazard_config for official models "NSHM_v1.0.0" and "NHSM_v1.0.4"

### Changed
 - Models args generated by factory function for official models retrieved by `get_model_version()`

### Removed
 - `NshmModel.source_logic_tree_nrml()` method

## [0.11.0] 2024-08-12

### Changed
 - model versions defined as argument dictionary rather than a NshmModel instance
 - model versions no longer loaded as modules by get_model_version()
 
### Removed
 - slt_config attribue of NshmModel

## [0.10.8] 2024-08-01

### Added
 - easy to read string representation of LogicTree
 - BranchSet class is an iterator which can be used to access its branches

## [0.10.7] 2024-08-01

### Changed
 - elevate stable version2 of source logic tree modules to top of source_logic_tree package
 - optional dependencies for minimum install

## [0.10.6] 2024-07-03

official 0.10.6 release

## [0.10.5] 2024-06-07
### Added
 - short_name and long_name for ground motion branch_sets of stored models

### Changed
 - ground motion logic trees loaded from json instead of xml

## [0.10.4] 2024-04-12
### Added
 - tectonic_region_types member for SourceBranch

### Changed
 - tectonic_region_type moved from GMCMBranchSet to GMCMBranch
 - renamed property LogicTree.combined_branches to composite_branches for clarity

## [0.10.3] 2024-03
### Added
 - BranchRegistry
 - auto digest on BranchRegistryEntry
 - botocode error handling for toshiAPI

## [0.10.1] 2024-03

### Added
 - migrated OpenquakeConfig class from runzi
 - added test to above
 - added hazard_config_compat module for hashig compatible configs

### Changed
 - fixed broken import for toshi

## [0.9.3] 2024-03-18

### Changed
 - NshmModel property gmm_logic_tree returns a GMCMLogicTree object rather than an OpenQuake psha_adaptor object

## [0.9.2] 2024-02-26

### Added
 - create LogicTree objects from hand-built json

### Changed
 - alter form of serialized LogicTree object

## [0.9.1] 2024-02-26

### Changed
 - correlations are ported when converting from version1 to version2 of source logic tree

## [0.9.0] 2024-02-21

### Added
 - classes and methods to enforce correlation between logic tree branches

### Changed
 - test matrix includes python3.10, 3.11, windows, macOS

### Fixed
 - python3.11 dataclass compatibility


## [0.8.0] 2024-02-16

### Changed
- default model version is now NSHM_v.1.0.4
- code refactoring to improve docs and tests
- NshmModel gmm_logic_treee and source_logic_tree are now properties not functions()
- get_model_version in nzshm_model is now a wrapper for the underlying NzshmModel implementation
- added mkdocs-click for cli docs
- removed stale code from scripts

### Added
- documentation setup
- new NshmModel methods
  - get_model_version
  - get_source_branch_sets
- more test coverage
- API documentation
- scripts documentation

## [0.7.0] 2024-01-11

### Added

- logic tree base classes

### Changed

- source logic tree fault systems now named branch sets. API aliases available for backward compatibility with deprecation warning
- source branch tag method changed to property

## [0.6.0] 2023-12-21

### Added

- GMCM logic tree classes for ground motion model serialization and deserialization (as json or xml)
- OpenQuake specific adaptor for GMCM logic tree classes (nrml)

### Changed

- PshaAdaptorInterface used for both source and ground motion logic trees

## [0.5.3] 2023-12-21

### Added

- added backward_compatible property `fault_system_lts` with deprecation warning.

## [0.5.2] 2023-12-14

### Changed

- Updated GMCM logic tree nrml files to reflect new OpenQuake class names and arguments for NZ NSHM gsims

## [0.5.1] 2023-12-14

### Changed

- SourceLogicTree.from_branches() returns logic tree with Branch objects rather than FilterdBranch objects
- remove whitespace from logic tree file paths for compatability with OpenQuake

## [0.5.0] 2023-12-12

## Added

- support caching of downloads
- build sources xml
- migration of version1 to version2 SLT
- iterate branches with SourceLogicTree
- build new SLT from branches iterable
- scripts/cli config command demonstrates building openquake config from an SLT

## [0.4.1] - 2023-12-05

## Added

- new scripts/cli module for PSHA related tasks, starting with fetch_sources
- psha_adapter pattern, with openquake package as first example

## Changed

- new package structure for psha_adapter(s)

## [0.4.0] - 2023-11-22

## Changed

- refactor into resources package
- fix incorrect version info on v1.0.0 and v1.0.4 SLT json
- remove twine from project
- Revert "correlation values stored as sets"

## Added

- new model class to make model definitions DRY;
- new nrml package to make classnames more compatible with GEM conventions
- gmm_logic_tree added to models
- SRM logic trees for various model hazard aggregations (in resources/SRM_LTs)

## [0.3.1] - 2023-11-14

## Fixed

- correlations use list comparison rather than cast to set to avoid unhashable type TypeError

## [0.3.0] - 2023-04-03

## Added

- rupture_set_id to branch

## Changed

- renamed `nshm_1.0.0` to `nshm_v1.0.0`
- renamed `nshm_1.0.4` to `nshm_v1.0.4`

## [0.2.0] - 2023-04-03

## Added

- new NSHM_1.0.4 model
- correlations between fault systems

## Changed

- flattened logic trees using combinations of fault system logic tree branches
- renamed field on SourceLogicTree `fault_system_branches` to `fault_system_lts`
- ensure logic tree classes are JSON serialisable

## [0.1.1] - 2022-12-19

## Changed

- refactored project structure for packaging
- scripts moved to /scripts package
- changelog format for bump2version
- remove docs build

## Added

- poetry with: pytest, coverage, tox, flake8, mypy, black, isort, bump2version
- github actions for CI/CD
- source_logic_tree feature

## [0.0.1] - 2022-10-04

Initial release of the NZ NSHM 2022 revision
